# Lab #13

---

### ArgoCD in k8s

![img.png](img.png)

### Correct logic in ArgoCD

![img_1.png](img_1.png)

### Starting application with ArgoCD

* To reduce the amount of unnecessary work, I just commented out the parts of the manifests of application
  (such as secrets and pre-install-hook)

* Also, I have problems with correctly deleting the ArgoCD deployment, then I use the next command
  to properly remove all the deprecated things: 
  `kubectl patch application/APP_NAME --type json --patch='[ { "op": "remove", "path": "/metadata/finalizers" } ]' -n argocd`

```bash
catorleader@CatOrLeader:/mnt/d/Studying/S25-core-course-labs/k8s$ argocd app get python-app
Name:               argocd/python-app
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          default
URL:                https://argocd.example.com/applications/python-app
Source:
- Repo:             https://github.com/CatOrLeader/S25-core-course-labs.git
  Target:           lab13
  Path:             k8s/python-app
  Helm Values:      values.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to lab13 (b64af8e)
Health Status:      Healthy

GROUP  KIND            NAMESPACE  NAME                   STATUS     HEALTH   HOOK      MESSAGE
       ServiceAccount  default    python-app             Synced                        serviceaccount/python-app created
       ConfigMap       default    config-map-python-app  Synced                        configmap/config-map-python-app created
       Service         default    python-app             Synced     Healthy            service/python-app created
apps   Deployment      default    python-app             Synced     Healthy            deployment.apps/python-app created
       Pod             default    post-hook-python-app   Succeeded           PostSync  pod/post-hook-python-app created
catorleader@CatOrLeader:/mnt/d/Studying/S25-core-course-labs/k8s$ argocd app sync python-app
TIMESTAMP                  GROUP        KIND       NAMESPACE                  NAME     STATUS   HEALTH        HOOK  MESSAGE
2025-03-04T10:56:10+03:00         ServiceAccount     default            python-app     Synced
2025-03-04T10:56:10+03:00   apps  Deployment         default            python-app     Synced  Healthy
2025-03-04T10:56:10+03:00          ConfigMap         default  config-map-python-app    Synced
2025-03-04T10:56:10+03:00            Service         default            python-app     Synced  Healthy
2025-03-04T10:56:12+03:00         ServiceAccount     default            python-app     Synced                       serviceaccount/python-app unchanged
2025-03-04T10:56:12+03:00          ConfigMap         default  config-map-python-app    Synced                       configmap/config-map-python-app unchanged
2025-03-04T10:56:12+03:00            Service         default            python-app     Synced  Healthy              service/python-app unchanged
2025-03-04T10:56:12+03:00   apps  Deployment         default            python-app     Synced  Healthy              deployment.apps/python-app unchanged
2025-03-04T10:56:12+03:00                Pod     default  post-hook-python-app   Running   Synced    PostSync  pod/post-hook-python-app created
2025-03-04T10:56:32+03:00                Pod     default  post-hook-python-app  Succeeded   Synced    PostSync  pod/post-hook-python-app created

Name:               argocd/python-app
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          default
URL:                https://argocd.example.com/applications/python-app
Source:
- Repo:             https://github.com/CatOrLeader/S25-core-course-labs.git
  Target:           lab13
  Path:             k8s/python-app
  Helm Values:      values.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to lab13 (b64af8e)
Health Status:      Healthy

Operation:          Sync
Sync Revision:      b64af8e476e4c940b253718cf1b975037a70416d
Phase:              Succeeded
Start:              2025-03-04 10:56:10 +0300 MSK
Finished:           2025-03-04 10:56:32 +0300 MSK
Duration:           22s
Message:            successfully synced (no more tasks)

GROUP  KIND            NAMESPACE  NAME                   STATUS     HEALTH   HOOK      MESSAGE
       ServiceAccount  default    python-app             Synced                        serviceaccount/python-app unchanged
       ConfigMap       default    config-map-python-app  Synced                        configmap/config-map-python-app unchanged
       Service         default    python-app             Synced     Healthy            service/python-app unchanged
apps   Deployment      default    python-app             Synced     Healthy            deployment.apps/python-app unchanged
       Pod             default    post-hook-python-app   Succeeded           PostSync  pod/post-hook-python-app created
catorleader@CatOrLeader:/mnt/d/Studying/S25-core-course-labs/k8s$
```

### Updating application

* Then, I set the application `replicaCount` to 3, and push changes into the repository. It takes time to 
  ArgoCD synchronization process (by default: 3 minutes)

* On the screenshot, you can check the sha commit value

![img_2.png](img_2.png)

![img_3.png](img_3.png)

### Additional application


